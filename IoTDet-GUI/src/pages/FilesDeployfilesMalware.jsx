import {useEffect, useState} from "react";
import {Alert, Button, CircularProgress, Grid, Snackbar} from "@mui/material";
import * as React from "react";
import {getAllDeployfilesMalware} from "../services/FileRequests.js";
import DialogNewDeployfileMalware from "../components/Dialog/DialogNewDeployfileMalware.jsx";
import CardDeployfileMalware from "../components/Cards/CardDeployfileMalware.jsx";

const FilesDeployfilesMalware = () => {
    const [state, setState] = useState({
        loading: true,
        deployfiles: [],
        openDialogUpload: false,
        showUploadSuccessfully: false
    })

    useEffect(() => {
        getAllDeployfilesMalware()
            .then(response => {
                setState({
                    ...state,
                    loading: false,
                    deployfiles: response.data
                })
            })
    }, [])


    const handleUploadSuccessfully = (deployfile) => {

        setState(prevState => ({
            ...prevState,
            deployfiles: [...prevState.deployfiles, deployfile],
            showUploadSuccessfully: true,
            openDialogUpload: false
        }));
    }
    return (

        <Grid item container sx={{mt: '50px'}}>
            {
                state.loading
                    ?
                    <Grid item xs={12}>
                        <Grid container alignItems="center" justifyContent="center">
                            <CircularProgress sx={{color: 'white'}}/>
                        </Grid>
                    </Grid>

                    :
                    <Grid container spacing={2}>
                        <Grid container justifyContent="flex-end" sx={{mb: '30px'}}>
                            <Button
                                disabled={JSON.parse(localStorage.getItem("user")).role === 3} size="small"
                                variant="contained" sx={{borderRadius: '28px', fontWeight: 'bold'}}
                                onClick={() => setState({...state, openDialogUpload: true})}
                                color="success">Upload deployfile</Button>
                        </Grid>

                        {
                            state.deployfiles.map((el, index) => (
                                <Grid key={index} item xs={3}>
                                    <CardDeployfileMalware deployfile={el}/>

                                </Grid>
                            ))
                        }

                    </Grid>

            }
            <DialogNewDeployfileMalware open={state.openDialogUpload}
                                        handleClose={() => setState({...state, openDialogUpload: false})}
                                        handleSuccess={handleUploadSuccessfully}/>
            <Snackbar anchorOrigin={{vertical: "bottom", horizontal: "right"}}
                      open={state.showUploadSuccessfully} autoHideDuration={3000}
                      onClose={() => setState({...state, showUploadSuccessfully: false})}>
                <Alert onClose={() => setState({...state, showUploadSuccessfully: false})} severity="success"
                       sx={{width: '100%'}}>
                    The deployfile has been uploaded successfully. Wait until an admin validates it!
                </Alert>
            </Snackbar>

        </Grid>
    )
}

export default FilesDeployfilesMalware